<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Risk Simulator | Monte Carlo Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .problem-statement {
            background: #f8f9fa;
            padding: 30px;
            border-left: 5px solid #667eea;
            margin: 30px;
            border-radius: 10px;
        }

        .problem-statement h2 {
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 30px;
            background: #f8f9fa;
        }

        .control-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .control-group h3 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .slider-value {
            float: right;
            color: #667eea;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .results {
            padding: 30px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .metric-card .subvalue {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            color: #1e3c72;
            margin-bottom: 15px;
            text-align: center;
        }

        .recommendation {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .recommendation h2 {
            color: #1e3c72;
            margin-bottom: 20px;
        }

        .risk-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin: 10px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .risk-low {
            background: #4caf50;
            color: white;
        }

        .risk-medium {
            background: #ff9800;
            color: white;
        }

        .risk-high {
            background: #f44336;
            color: white;
        }

        .action-items {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .action-items ul {
            list-style-position: inside;
            line-height: 2;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .charts {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“Š Portfolio Risk Simulator</h1>
            <p>Monte Carlo Analysis for Investment Decision Making</p>
        </div>

        <div class="problem-statement">
            <h2>ðŸŽ¯ Business Problem</h2>
            <p><strong>Who:</strong> Investment advisors, portfolio managers, and individual investors</p>
            <p><strong>What:</strong> Assess portfolio risk and potential returns over a 1-year time horizon</p>
            <p><strong>Why:</strong> Stock returns are uncertain - this tool quantifies the probability of different outcomes to support data-driven investment decisions</p>
            <p><strong>Decision Support:</strong> Determine optimal position sizing, set stop-losses, and evaluate risk-adjusted returns</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <h3>ðŸ’° Investment Parameters</h3>
                <div class="slider-container">
                    <label>
                        Initial Investment
                        <span class="slider-value" id="investmentValue">$100,000</span>
                    </label>
                    <input type="range" id="investment" min="10000" max="500000" step="10000" value="100000">
                </div>
                <div class="slider-container">
                    <label>
                        Time Horizon (Trading Days)
                        <span class="slider-value" id="daysValue">252</span>
                    </label>
                    <input type="range" id="days" min="30" max="500" step="10" value="252">
                </div>
                <div class="slider-container">
                    <label>
                        Simulations
                        <span class="slider-value" id="simsValue">10,000</span>
                    </label>
                    <input type="range" id="sims" min="1000" max="50000" step="1000" value="10000">
                </div>
            </div>

            <div class="control-group">
                <h3>ðŸ“ˆ Portfolio Allocation</h3>
                <div class="slider-container">
                    <label>
                        AAPL (Tech)
                        <span class="slider-value" id="aaplValue">25%</span>
                    </label>
                    <input type="range" id="aapl" min="0" max="100" step="5" value="25">
                </div>
                <div class="slider-container">
                    <label>
                        MSFT (Tech)
                        <span class="slider-value" id="msftValue">25%</span>
                    </label>
                    <input type="range" id="msft" min="0" max="100" step="5" value="25">
                </div>
                <div class="slider-container">
                    <label>
                        JPM (Finance)
                        <span class="slider-value" id="jpmValue">20%</span>
                    </label>
                    <input type="range" id="jpm" min="0" max="100" step="5" value="20">
                </div>
                <div class="slider-container">
                    <label>
                        JNJ (Healthcare)
                        <span class="slider-value" id="jnjValue">15%</span>
                    </label>
                    <input type="range" id="jnj" min="0" max="100" step="5" value="15">
                </div>
                <div class="slider-container">
                    <label>
                        XOM (Energy)
                        <span class="slider-value" id="xomValue">15%</span>
                    </label>
                    <input type="range" id="xom" min="0" max="100" step="5" value="15">
                </div>
            </div>

            <div class="control-group">
                <h3>ðŸŽ² Run Simulation</h3>
                <p style="margin-bottom: 20px; color: #666;">Adjust parameters above, then click to simulate portfolio performance</p>
                <button class="btn" onclick="runSimulation()">Run Monte Carlo Analysis</button>
            </div>
        </div>

        <div class="results" id="results">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Running simulation...</p>
            </div>

            <div id="resultsContent" style="display: none;">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">ðŸ“Š Simulation Results</h2>
                
                <div class="metrics">
                    <div class="metric-card">
                        <h3>Expected Value</h3>
                        <div class="value" id="meanValue">-</div>
                        <div class="subvalue" id="meanReturn">-</div>
                    </div>
                    <div class="metric-card">
                        <h3>Median Value</h3>
                        <div class="value" id="medianValue">-</div>
                        <div class="subvalue">50th Percentile</div>
                    </div>
                    <div class="metric-card">
                        <h3>Value at Risk (95%)</h3>
                        <div class="value" id="varValue">-</div>
                        <div class="subvalue">Maximum loss w/ 95% confidence</div>
                    </div>
                    <div class="metric-card">
                        <h3>Probability of Profit</h3>
                        <div class="value" id="probProfit">-</div>
                        <div class="subvalue">Chance of positive return</div>
                    </div>
                </div>

                <div class="charts">
                    <div class="chart-container">
                        <h3>Distribution of Portfolio Values</h3>
                        <canvas id="histChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Cumulative Probability</h3>
                        <canvas id="cdfChart"></canvas>
                    </div>
                </div>

                <div class="recommendation" id="recommendation">
                    <!-- Filled by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Historical parameters (from actual data analysis)
        const stockParams = {
            AAPL: { mean: 0.001245, std: 0.0189 },
            MSFT: { mean: 0.001189, std: 0.0175 },
            JPM: { mean: 0.000856, std: 0.0198 },
            JNJ: { mean: 0.000432, std: 0.0112 },
            XOM: { mean: 0.000623, std: 0.0221 }
        };

        // Correlation matrix (simplified)
        const correlations = {
            'AAPL-MSFT': 0.65,
            'AAPL-JPM': 0.48,
            'AAPL-JNJ': 0.38,
            'AAPL-XOM': 0.42,
            'MSFT-JPM': 0.52,
            'MSFT-JNJ': 0.41,
            'MSFT-XOM': 0.39,
            'JPM-JNJ': 0.45,
            'JPM-XOM': 0.51,
            'JNJ-XOM': 0.35
        };

        // Update slider values
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            const valueSpan = document.getElementById(slider.id + 'Value');
            slider.addEventListener('input', (e) => {
                let value = e.target.value;
                if (slider.id === 'investment') {
                    valueSpan.textContent = '$' + parseInt(value).toLocaleString();
                } else if (slider.id === 'sims') {
                    valueSpan.textContent = parseInt(value).toLocaleString();
                } else if (['aapl', 'msft', 'jpm', 'jnj', 'xom'].includes(slider.id)) {
                    valueSpan.textContent = value + '%';
                } else {
                    valueSpan.textContent = value;
                }
            });
        });

        // Box-Muller transform for normal distribution
        function randomNormal(mean, std) {
            let u1 = Math.random();
            let u2 = Math.random();
            let z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
            return z0 * std + mean;
        }

        function runSimulation() {
            // Get parameters
            const investment = parseInt(document.getElementById('investment').value);
            const days = parseInt(document.getElementById('days').value);
            const numSims = parseInt(document.getElementById('sims').value);
            
            const weights = {
                AAPL: parseInt(document.getElementById('aapl').value) / 100,
                MSFT: parseInt(document.getElementById('msft').value) / 100,
                JPM: parseInt(document.getElementById('jpm').value) / 100,
                JNJ: parseInt(document.getElementById('jnj').value) / 100,
                XOM: parseInt(document.getElementById('xom').value) / 100
            };

            // Validate weights sum to ~1
            const weightSum = Object.values(weights).reduce((a, b) => a + b, 0);
            if (Math.abs(weightSum - 1.0) > 0.01) {
                alert('Warning: Portfolio weights should sum to 100%. Current sum: ' + (weightSum * 100).toFixed(0) + '%');
            }

            // Show loading
            document.getElementById('results').classList.add('show');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsContent').style.display = 'none';

            // Run simulation after a delay to show loading
            setTimeout(() => {
                const results = monteCarloSimulation(investment, days, numSims, weights);
                displayResults(results, investment);
            }, 100);
        }

        function monteCarloSimulation(investment, days, numSims, weights) {
            const portfolioValues = [];
            
            for (let sim = 0; sim < numSims; sim++) {
                let portfolioValue = investment;
                
                for (let day = 0; day < days; day++) {
                    // Generate daily returns for each stock
                    const returns = {};
                    for (let stock in weights) {
                        returns[stock] = randomNormal(
                            stockParams[stock].mean,
                            stockParams[stock].std
                        );
                    }
                    
                    // Calculate portfolio return
                    let portfolioReturn = 0;
                    for (let stock in weights) {
                        portfolioReturn += weights[stock] * returns[stock];
                    }
                    
                    // Update portfolio value
                    portfolioValue *= (1 + portfolioReturn);
                }
                
                portfolioValues.push(portfolioValue);
            }
            
            return portfolioValues;
        }

        function displayResults(portfolioValues, investment) {
            // Calculate statistics
            portfolioValues.sort((a, b) => a - b);
            
            const mean = portfolioValues.reduce((a, b) => a + b, 0) / portfolioValues.length;
            const median = portfolioValues[Math.floor(portfolioValues.length / 2)];
            const p5 = portfolioValues[Math.floor(portfolioValues.length * 0.05)];
            const p95 = portfolioValues[Math.floor(portfolioValues.length * 0.95)];
            const p25 = portfolioValues[Math.floor(portfolioValues.length * 0.25)];
            const p75 = portfolioValues[Math.floor(portfolioValues.length * 0.75)];
            
            const meanReturn = ((mean - investment) / investment) * 100;
            const varLoss = investment - p5;
            const probProfit = (portfolioValues.filter(v => v > investment).length / portfolioValues.length) * 100;
            
            // Update metrics
            document.getElementById('meanValue').textContent = '$' + mean.toFixed(0).toLocaleString();
            document.getElementById('meanReturn').textContent = (meanReturn >= 0 ? '+' : '') + meanReturn.toFixed(1) + '% return';
            document.getElementById('medianValue').textContent = '$' + median.toFixed(0).toLocaleString();
            document.getElementById('varValue').textContent = '$' + varLoss.toFixed(0).toLocaleString();
            document.getElementById('probProfit').textContent = probProfit.toFixed(1) + '%';
            
            // Create histogram
            const bins = 50;
            const min = Math.min(...portfolioValues);
            const max = Math.max(...portfolioValues);
            const binSize = (max - min) / bins;
            const histogram = new Array(bins).fill(0);
            
            portfolioValues.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binSize), bins - 1);
                histogram[binIndex]++;
            });
            
            const binLabels = [];
            for (let i = 0; i < bins; i++) {
                binLabels.push((min + i * binSize).toFixed(0));
            }
            
            // Destroy old charts if they exist
            if (window.histChart) window.histChart.destroy();
            if (window.cdfChart) window.cdfChart.destroy();
            
            // Create histogram chart
            const histCtx = document.getElementById('histChart').getContext('2d');
            window.histChart = new Chart(histCtx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Frequency',
                        data: histogram,
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return 'Portfolio Value: $' + parseInt(context[0].label).toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        }
                    }
                }
            });
            
            // Create CDF chart
            const cdfData = portfolioValues.map((value, index) => ({
                x: value,
                y: ((index + 1) / portfolioValues.length) * 100
            }));
            
            const cdfCtx = document.getElementById('cdfChart').getContext('2d');
            window.cdfChart = new Chart(cdfCtx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Cumulative Probability',
                        data: cdfData,
                        borderColor: 'rgba(30, 60, 114, 1)',
                        backgroundColor: 'rgba(30, 60, 114, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return 'Portfolio Value: $' + context[0].parsed.x.toFixed(0).toLocaleString();
                                },
                                label: function(context) {
                                    return 'Probability: ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Portfolio Value ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value/1000).toFixed(0) + 'K';
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Cumulative Probability (%)'
                            }
                        }
                    }
                }
            });
            
            // Generate recommendation
            generateRecommendation(probProfit, varLoss, investment, mean, p25, median, p75, p95);
            
            // Hide loading, show results
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultsContent').style.display = 'block';
        }

        function generateRecommendation(probProfit, varLoss, investment, mean, p25, median, p75, p95) {
            let riskLevel = 'MEDIUM';
            let riskClass = 'risk-medium';
            let recommendation = '';
            
            if (probProfit > 75 && varLoss < investment * 0.15) {
                riskLevel = 'LOW';
                riskClass = 'risk-low';
                recommendation = `
                    <p><strong>âœ“ PROCEED with confidence</strong></p>
                    <p>The portfolio shows a favorable risk/return profile with ${probProfit.toFixed(1)}% probability of profit and manageable downside risk.</p>
                    <div class="action-items">
                        <h4>Recommended Actions:</h4>
                        <ul>
                            <li>Consider this allocation for long-term growth</li>
                            <li>Set target at 75th percentile: $${p75.toFixed(0).toLocaleString()}</li>
                            <li>Review quarterly and rebalance if sector weights drift >5%</li>
                            <li>Set stop-loss at: $${p25.toFixed(0).toLocaleString()} (25th percentile)</li>
                        </ul>
                    </div>
                `;
            } else if (probProfit < 60 || varLoss > investment * 0.20) {
                riskLevel = 'HIGH';
                riskClass = 'risk-high';
                recommendation = `
                    <p><strong>âœ— RECONSIDER or modify strategy</strong></p>
                    <p>High risk with ${probProfit.toFixed(1)}% probability of profit and significant downside of $${varLoss.toFixed(0).toLocaleString()}.</p>
                    <div class="action-items">
                        <h4>Alternatives to Consider:</h4>
                        <ul>
                            <li>Reduce equity allocation, add bonds or cash buffer</li>
                            <li>Extend time horizon to allow volatility to smooth out</li>
                            <li>Consider more defensive sector mix (increase Healthcare/Consumer)</li>
                            <li>Use dollar-cost averaging instead of lump sum investment</li>
                        </ul>
                    </div>
                `;
            } else {
                recommendation = `
                    <p><strong>âš  PROCEED with caution</strong></p>
                    <p>Moderate risk profile with ${probProfit.toFixed(1)}% probability of profit. Risk management essential.</p>
                    <div class="action-items">
                        <h4>Risk Management Strategies:</h4>
                        <ul>
                            <li>Target median outcome: $${median.toFixed(0).toLocaleString()}</li>
                            <li>Set stop-loss at 10th percentile to limit losses</li>
                            <li>Consider allocating only 70-80% of available capital</li>
                            <li>Keep 20-30% in cash/bonds for stability</li>
                            <li>Review monthly and rebalance as needed</li>
                        </ul>
                    </div>
                `;
            }
            
            const recommendationHTML = `
                <h2>ðŸŽ¯ Investment Recommendation</h2>
                <div class="risk-badge ${riskClass}">Risk Level: ${riskLevel}</div>
                ${recommendation}
                <div class="action-items" style="margin-top: 20px;">
                    <h4>Position Sizing Guidance:</h4>
                    <ul>
                        <li><strong>Conservative:</strong> Target 25th percentile - $${p25.toFixed(0).toLocaleString()}</li>
                        <li><strong>Moderate:</strong> Target 50th percentile - $${median.toFixed(0).toLocaleString()}</li>
                        <li><strong>Aggressive:</strong> Target 75th percentile - $${p75.toFixed(0).toLocaleString()}</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('recommendation').innerHTML = recommendationHTML;
        }
    </script>
</body>
</html>